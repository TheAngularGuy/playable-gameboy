"use strict";(self.webpackChunkgameboy=self.webpackChunkgameboy||[]).push([[616],{616:(z,g,o)=>{o.r(g),o.d(g,{SnakeComponent:()=>S,SnakeModule:()=>Q});var c=o(6019),f=o(4397),n=o(3556);function O(i,s){1&i&&n._UZ(0,"div",8)}const y=function(i,s){return{tail:i,head:s}};function x(i,s){if(1&i&&n._UZ(0,"div",9),2&i){const e=n.oxw().index,t=n.oxw().index,r=n.oxw(2);n.Q6J("ngClass",n.WLB(1,y,"TAIL"===r.snakeHashmap.get(e+","+t),"HEAD"===r.snakeHashmap.get(e+","+t)))}}const C=function(i,s,e,t){return{bt:i,br:s,bb:e,bl:t}};function T(i,s){if(1&i&&(n.TgZ(0,"div",5),n.YNc(1,O,1,0,"div",6),n.YNc(2,x,1,4,"div",7),n.qZA()),2&i){const e=s.$implicit,t=s.index,r=n.oxw().index,a=n.oxw(2);n.Q6J("ngClass",n.l5B(3,C,e.top,e.right,e.bottom,e.left)),n.xp6(1),n.Q6J("ngIf",a.apple&&t===a.apple[0]&&r===a.apple[1]),n.xp6(1),n.Q6J("ngIf",a.snakeHashmap.has(t+","+r))}}function A(i,s){if(1&i&&(n.TgZ(0,"div",3),n.YNc(1,T,3,8,"div",4),n.qZA()),2&i){const e=s.$implicit,t=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",e)("ngForTrackBy",t.trackByFn)}}function w(i,s){if(1&i&&(n.TgZ(0,"div",1),n.YNc(1,A,2,2,"div",2),n.qZA()),2&i){const e=n.oxw();n.xp6(1),n.Q6J("ngForOf",e.grid)}}let M=(()=>{class i{constructor(){this.snakeHashmap=new Map,this.trackByFn=(e,t)=>t.id}set snake(e){if(e){this.snakeHashmap.clear();for(const t of e){let r="BODY";t.tail?r="TAIL":t.head&&(r="HEAD"),this.snakeHashmap.set(`${t.x},${t.y}`,r)}}}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=n.Xpm({type:i,selectors:[["app-snake-grid"]],inputs:{apple:"apple",grid:"grid",snake:"snake"},decls:1,vars:1,consts:[["class","grid",4,"ngIf"],[1,"grid"],["class","line",4,"ngFor","ngForOf"],[1,"line"],["class","cell",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"cell",3,"ngClass"],["class","apple",4,"ngIf"],["class","snake",3,"ngClass",4,"ngIf"],[1,"apple"],[1,"snake",3,"ngClass"]],template:function(e,t){1&e&&n.YNc(0,w,2,1,"div",0),2&e&&n.Q6J("ngIf",t.grid)},directives:[c.O5,c.sg,c.mk],styles:['[_nghost-%COMP%]{display:block}.grid[_ngcontent-%COMP%]{--cellSize: 3.4%;--grindScale: 1;--light: transparent;--dark: #270714;margin:0;padding-top:5%;transform:scale(var(--grindScale))}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:flex;justify-content:center}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .cell[_ngcontent-%COMP%]{background:var(--light);position:relative;width:var(--cellSize);aspect-ratio:1/1;display:flex;justify-content:center;align-items:center}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .cell[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;bottom:0;left:0;right:0}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .bt[_ngcontent-%COMP%]:after{border-top:1px solid var(--dark)}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .bb[_ngcontent-%COMP%]:after{border-bottom:1px solid var(--dark)}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .br[_ngcontent-%COMP%]:after{border-right:1px solid var(--dark)}.grid[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .bl[_ngcontent-%COMP%]:after{border-left:1px solid var(--dark)}.snake[_ngcontent-%COMP%]{z-index:2;content:"";position:absolute;top:0;bottom:0;left:0;right:0;border-radius:5%;background:transparent;border:1px solid #000000aa}.snake.head[_ngcontent-%COMP%]{background:#00000099}.apple[_ngcontent-%COMP%]{z-index:1;content:"";position:absolute;top:5%;bottom:5%;left:5%;right:5%;border-radius:50%;background:red;border:1px solid red}'],changeDetection:0}),i})();var k=o(273),I=o(4516);let v=(()=>{class i{constructor(e){this.utils=e,this.width=0,this.height=0,this.grid=[],this.snake=[],this.apple=[0,0],this.cellToAdd=[],this.ateApple$=new k.x,this.snakeDied$=new k.x}getGrid(e=32,t=32){return this.width=e,this.height=t,this.initChamber(),this.grid}initChamber(){this.grid=[];for(let e=0;e<this.height;e++){const t=[];for(let r=0;r<this.width;r++)t.push({top:0===e,left:0===r,bottom:e===this.height-1,right:r===this.width-1,id:this.width*e+r});this.grid.push(t)}this.initSnake(),this.placeRandomApple()}getApple(){return this.apple}getSnake(){return this.snake}placeRandomApple(){const e=this.utils.getRandomIntBetween(0,this.grid.length-1),t=this.utils.getRandomIntBetween(0,this.grid[0].length-1);return this.snake.find(r=>r.x===t&&r.y===e)?this.placeRandomApple():(this.apple=[t,e],this.apple)}initSnake(){const e=[];for(let t=0;t<5;t++)e.push({tail:0===t,id:t,head:4===t,y:1,x:t+1});return this.snake=e.reverse(),e}move(e){switch(e){case"TOP":this.moveSnakeTop();break;case"RIGHT":this.moveSnakeRight();break;case"BOTTOM":this.moveSnakeBottom();break;case"LEFT":this.moveSnakeLeft()}this.checkIfAteApple(),this.cellToAdd=this.cellToAdd.map(t=>{const r=Object.assign({},t);return r.rounds--,r}).filter(t=>t.rounds>=0)}checkIfAteApple(){const e=this.snake[0];e.x===this.apple[0]&&e.y===this.apple[1]&&(this.cellToAdd.push({x:e.x,y:e.y,rounds:this.snake.length-1}),this.placeRandomApple(),this.ateApple$.next(!0))}copyRestOfTheSnake(e){for(let t=1;t<this.snake.length;t++){if(this.snake[t-1].x===e[0].x&&this.snake[t-1].y===e[0].y)return this.snakeDied$.next(!0),this.snake;e[t].x=this.snake[t-1].x,e[t].y=this.snake[t-1].y}return this.cellToAdd[0]&&0===this.cellToAdd[0].rounds&&(e.push(Object.assign({},this.snake[this.snake.length-1])),e[e.length-2].tail=!1),e}moveSnakeLeft(){const e=this.snake.map(t=>Object.assign({},t));return e[0].x-=1,-1===e[0].x&&(e[0].x=this.grid[0].length-1),this.snake=this.copyRestOfTheSnake(e),this.snake}moveSnakeRight(){const e=this.snake.map(t=>Object.assign({},t));return e[0].x+=1,e[0].x=e[0].x%this.grid[0].length,this.snake=this.copyRestOfTheSnake(e),this.snake}moveSnakeBottom(){const e=this.snake.map(t=>Object.assign({},t));return e[0].y+=1,e[0].y=e[0].y%this.grid.length,this.snake=this.copyRestOfTheSnake(e),this.snake}moveSnakeTop(){const e=this.snake.map(t=>Object.assign({},t));return e[0].y-=1,-1===e[0].y&&(e[0].y=this.grid.length-1),this.snake=this.copyRestOfTheSnake(e),this.snake}}return i.\u0275fac=function(e){return new(e||i)(n.LFG(I.F))},i.\u0275prov=n.Yz7({token:i,factory:i.\u0275fac}),i})();var u=o(7908);class P extends u.w0{constructor(s,e){super()}schedule(s,e=0){return this}}const p={setInterval(...i){const{delegate:s}=p;return((null==s?void 0:s.setInterval)||setInterval)(...i)},clearInterval(i){const{delegate:s}=p;return((null==s?void 0:s.clearInterval)||clearInterval)(i)},delegate:void 0};var $=o(3980);const m={now:()=>(m.delegate||Date).now(),delegate:void 0};class l{constructor(s,e=l.now){this.schedulerActionCtor=s,this.now=e}schedule(s,e=0,t){return new this.schedulerActionCtor(this,s).schedule(t,e)}}l.now=m.now;const b=new class extends l{constructor(s,e=l.now){super(s,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(s){const{actions:e}=this;if(this._active)return void e.push(s);let t;this._active=!0;do{if(t=s.execute(s.state,s.delay))break}while(s=e.shift());if(this._active=!1,t){for(;s=e.shift();)s.unsubscribe();throw t}}}(class extends P{constructor(s,e){super(s,e),this.scheduler=s,this.work=e,this.pending=!1}schedule(s,e=0){if(this.closed)return this;this.state=s;const t=this.id,r=this.scheduler;return null!=t&&(this.id=this.recycleAsyncId(r,t,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(s,e,t=0){return p.setInterval(s.flush.bind(s,this),t)}recycleAsyncId(s,e,t=0){if(null!=t&&this.delay===t&&!1===this.pending)return e;p.clearInterval(e)}execute(s,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const t=this._execute(s,e);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,e){let r,t=!1;try{this.work(s)}catch(a){t=!0,r=a||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:s,scheduler:e}=this,{actions:t}=e;this.work=this.state=this.scheduler=null,this.pending=!1,(0,$.P)(t,this),null!=s&&(this.id=this.recycleAsyncId(e,s,null)),this.delay=null,super.unsubscribe()}}}),G=b;var F=o(8305),R=o(7398);var j=o(9947),H=o(8889),Y=o(9985),J=o(6921),h=o(4499),d=o(7384),E=o(5174);function U(i,s){1&i&&(n.ynx(0),n.TgZ(1,"span",2),n._uU(2,"You lost!"),n.qZA(),n.TgZ(3,"span"),n._uU(4," press "),n.TgZ(5,"mark"),n._uU(6,"A"),n.qZA(),n._uU(7," to restart"),n.qZA(),n.BQk())}let S=(()=>{class i{constructor(e,t,r){this.snakeService=e,this.buttonsEventsService=t,this.router=r,this.grid=[],this.snake$=new h.X([]),this.apple$=new h.X([0,0]),this.gameOngoing$=new h.X(!1),this.score$=new h.X(0),this.bestScore$=new h.X(JSON.parse(window.localStorage.getItem("bestSnakeScore")||JSON.stringify(0))),this.subscriptionOnInit=new u.w0,this.subscriptionOnStart=new u.w0,this.direction="RIGHT"}ngOnDestroy(){this.subscriptionOnInit.unsubscribe(),this.subscriptionOnStart.unsubscribe()}ngOnInit(){const e=this.buttonsEventsService.buttonClick$.pipe((0,d.b)(t=>{"B"===t?this.goBack():"A"===t&&this.startGame(),this.keyCodeToMovementMapper(t)})).subscribe();this.startGame(),this.subscriptionOnInit.add(e)}startGame(){if(this.subscriptionOnStart.unsubscribe(),this.subscriptionOnStart=new u.w0,this.gameOngoing$.getValue())return;this.initGame();const e=this.snakeService.ateApple$.pipe((0,d.b)(()=>this.increaseScore())).subscribe(),t=this.snakeService.snakeDied$.pipe((0,d.b)(()=>this.gameOngoing$.next(!1))).subscribe(),r=function(i=0,s=b){return i<0&&(i=0),function(i=0,s,e=G){let t=-1;return null!=s&&((0,R.K)(s)?e=s:t=s),new F.y(r=>{let a=function(i){return i instanceof Date&&!isNaN(i)}(i)?+i-e.now():i;a<0&&(a=0);let X=0;return e.schedule(function(){r.closed||(r.next(X++),0<=t?this.schedule(void 0,t):r.complete())},a)})}(i,i,s)}(i.INTERVAL).pipe((0,d.b)(()=>this.direction=this.directionDemanded||this.direction),(0,d.b)(()=>this.moveSnake()),function(i){return(0,j.e)((s,e)=>{(0,Y.Xf)(i).subscribe(new H.Q(e,()=>e.complete(),J.Z)),!e.closed&&s.subscribe(e)})}(this.snakeService.snakeDied$)).subscribe();this.subscriptionOnStart.add(r),this.subscriptionOnStart.add(t),this.subscriptionOnStart.add(e)}increaseScore(){let e=this.bestScore$.getValue(),t=this.score$.getValue();t++,this.score$.next(t),t>e&&(this.bestScore$.next(t),window.localStorage.setItem("bestSnakeScore",JSON.stringify(t)))}initGame(){this.grid=this.snakeService.getGrid(20,20),this.snake$.next(this.snakeService.getSnake()),this.apple$.next(this.snakeService.getApple()),this.directionDemanded=void 0,this.direction="RIGHT",this.gameOngoing$.next(!0),this.score$.next(0)}moveSnake(){this.snakeService.move(this.direction),this.snake$.next(this.snakeService.getSnake()),this.apple$.next(this.snakeService.getApple())}goBack(){this.router.navigateByUrl("/")}keyCodeToMovementMapper(e){switch(e){case"TOP":return void("BOTTOM"!==this.direction&&(this.directionDemanded="TOP"));case"RIGHT":return void("LEFT"!==this.direction&&(this.directionDemanded="RIGHT"));case"BOTTOM":return void("TOP"!==this.direction&&(this.directionDemanded="BOTTOM"));case"LEFT":return void("RIGHT"!==this.direction&&(this.directionDemanded="LEFT"))}}}return i.INTERVAL=150,i.\u0275fac=function(e){return new(e||i)(n.Y36(v),n.Y36(E.h),n.Y36(f.F0))},i.\u0275cmp=n.Xpm({type:i,selectors:[["ng-component"]],decls:12,vars:16,consts:[[3,"grid","snake","apple"],[4,"ngIf"],[1,"lost"]],template:function(e,t){1&e&&(n._UZ(0,"app-snake-grid",0),n.ALo(1,"async"),n.ALo(2,"async"),n._UZ(3,"br"),n.YNc(4,U,8,0,"ng-container",1),n.ALo(5,"async"),n.TgZ(6,"p"),n._uU(7),n.ALo(8,"async"),n.qZA(),n.TgZ(9,"p"),n._uU(10),n.ALo(11,"async"),n.qZA()),2&e&&(n.Q6J("grid",t.grid)("snake",n.lcZ(1,6,t.snake$))("apple",n.lcZ(2,8,t.apple$)),n.xp6(4),n.Q6J("ngIf",!n.lcZ(5,10,t.gameOngoing$)),n.xp6(3),n.hij("Your current score is ",n.lcZ(8,12,t.score$),""),n.xp6(3),n.hij("Your best score is ",n.lcZ(11,14,t.bestScore$),""))},directives:function(){return[M,c.O5]},pipes:function(){return[c.Ov]},styles:['[_nghost-%COMP%]{display:block}p[_ngcontent-%COMP%], span[_ngcontent-%COMP%]{font-family:"Andale Mono",Helvetica,sans-serif}p[_ngcontent-%COMP%]{margin:0}.lost[_ngcontent-%COMP%]{display:inline-block;padding:0 5px;background:black;color:#efefef}'],changeDetection:0}),i})(),Q=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({providers:[v],imports:[[c.ez,f.Bz.forChild([{path:"",component:S}])]]}),i})()}}]);